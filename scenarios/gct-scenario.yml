# yaml-language-server: $schema=https://raw.githubusercontent.com/qgis-deployment/qgis-deployment-toolbelt-cli/refs/heads/main/docs/schemas/scenario/qdt_scenario.json

metadata:
  title: "Scénario GCT de déploiement de configuration Qgis de l'Eurométropole de Strasbourg"
  id: gct
  description: >-
    Scénario GCT de déploiement de configuration Qgis de l'Eurométropole de Strasbourg capabilities.

settings:
  QGIS_EXE_PATH: "%PROGRAMFILES%/QGIS/QGIS 3.28.4/bin/qgis-ltr-bin.exe"
  SCENARIO_VALIDATION: true

steps:
  - name: Download profiles remote local Git repository
    uses: qprofiles-downloader
    with:
      source: https://github.com/Ville-Eurometropole-Strasbourg/qgis-configuration
      protocol: git_remote
      branch: main

  - name: Synchronize downloaded profiles with installed ones
    uses: qprofiles-synchronizer
    with:
      sync_mode: only_new_version

  - name: Download plugins
    uses: qplugins-downloader
    with:
      threads: 5

  - name: Synchronize plugins
    uses: qplugins-synchronizer
    with:
      action: create_or_restore

  - name: Set splash screen
    uses: splash-screen-manager
    with:
      action: create_or_restore
      strict: false

  - name: Set environment variables
    uses: manage-env-vars
    with:
      - name: PGSERVICEFILE
        action: "add"
        scope: "user"
        value: "S:\\Commun\\RESSOURCE\\KEEPASS\\pg_service.conf"
        value_type: path

  - name: Set default profile to gct
    uses: default-profile-setter
    with:
      profile: gct
      force_profile_selection_policy: 2
